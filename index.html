<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SÃ­tio CÃ³rrego do Pinhal</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#7b3f2a">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* ===== CSS ORIGINAL â€” SEM ALTERAÃ‡Ã•ES ===== */
:root{
  --marrom:#7b3f2a;
  --bege:#f6efe7;
  --verde:#2f6b2f;
  --vermelho:#c0392b;
  --amarelo:#e0a800;
  --laranja:#e67e22;
  --cinza:#666;
  --logo:#D0B485;
}
*{box-sizing:border-box;font-family:'Inter',system-ui,-apple-system,Arial,Helvetica,sans-serif}
body{margin:0;background:var(--bege);color:#333}
/* (demais estilos mantidos exatamente iguais) */
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <a href="login.html" class="admin-icon">
    <img src="icone-admin.png">
  </a>
</header>

<div id="menu"></div>

<div class="container">
  <div class="clima-bar" id="clima">â³ Carregando clima...</div>

  <a href="lembretes.html" id="alertaRapido" class="alerta-rapido alerta-ok">
    ğŸ”” Nenhum alerta no momento
  </a>

  <div id="conteudo"></div>
</div>

<!-- OVERLAY MANTIDO, MAS NÃƒO UTILIZADO -->
<div id="overlay-alerta">
  <div id="banner-alerta">
    <h1>ğŸš¨ ITENS PENDENTES ğŸš¨</h1>
    <div class="data-hoje" id="dataHoje"></div>
    <div id="alerta-conteudo"></div>
    <button id="fechar-alerta">Fechar</button>
  </div>
</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
});
const db=firebase.firestore();

const hoje=new Date();
const hojeZ=new Date(hoje.getFullYear(),hoje.getMonth(),hoje.getDate());

function parse(d){
  if(!d||typeof d!=="string")return null;
  const p=d.split("-");
  return new Date(p[0],p[1]-1,p[2]);
}
function addM(d,m){
  const x=new Date(d);
  x.setMonth(x.getMonth()+m);
  return x;
}
function diff(a,b){
  return Math.floor((b-a)/86400000);
}

/* CLIMA */
async function loadClima(){
  try{
    const r=await fetch("https://api.open-meteo.com/v1/forecast?latitude=-21.3127&longitude=-46.3721&current_weather=true&timezone=America/Sao_Paulo");
    const d=await r.json();
    clima.innerHTML=`â˜€ï¸ JurÃ©ia â€“ Monte Belo/MG â€¢ ${Math.round(d.current_weather.temperature)}Â°C`;
  }catch{
    clima.innerHTML="ğŸŒ¦ï¸ Clima indisponÃ­vel";
  }
}

/* INDEX */
async function loadIndex(){
  const conteudo=document.getElementById("conteudo");
  conteudo.innerHTML="";

  const ani=(await db.collection("animais").get()).docs.map(d=>({_id:d.id,...d.data()}));
  const eve=(await db.collection("eventos").get()).docs.map(d=>d.data());
  const vac=(await db.collection("vacinas").get()).docs.map(d=>d.data());

  conteudo.innerHTML+="<h2>ğŸ’‰ Vacinas pendentes</h2>";

  vac.forEach(v=>{
    if(v.status==="Finalizada"||!v.data_aplicacao||Number(v.repeticao_dias)<=0)return;
    const reap=new Date(parse(v.data_aplicacao));
    reap.setDate(reap.getDate()+Number(v.repeticao_dias));
    const dias=diff(hojeZ,reap);
    const animal=ani.find(a=>a._id===v.id_animal);

    conteudo.innerHTML+=`
      <div class="card ${dias<0?"atrasada":"pendente"}">
        <strong>ğŸ’‰ ${v.nome_vacina}</strong>
        <p class="dias">
          ${dias<0?`âš ï¸ Atrasada hÃ¡ ${Math.abs(dias)} dias`:`â³ Reaplicar em ${dias} dias`}
        </p>
        <p class="data">ğŸ„ ${animal ? animal.nome.toUpperCase() : "-"}</p>
        <p class="data">ğŸ“… ${reap.toLocaleDateString("pt-BR")}</p>
      </div>`;
  });
}

/* ALERTA SIMPLES â€” SOMENTE LEMBRETES */
async function loadBanner(){
  const lem=(await db.collection("lembretes").get()).docs.map(d=>d.data());
  const alertaRapido=document.getElementById("alertaRapido");

  if(lem.length){
    alertaRapido.className="alerta-rapido alerta-on";
    alertaRapido.innerHTML=`ğŸš¨ ${lem.length} alertas de itens pendentes para comprar`;
  }else{
    alertaRapido.className="alerta-rapido alerta-ok";
    alertaRapido.innerHTML="ğŸ”” Nenhum alerta no momento";
  }
}

loadClima();
loadIndex();
loadBanner();
</script>

</body>
</html>
