<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S√≠tio C√≥rrego do Pinhal</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --vinho:#7A1E2C;
  --bege-claro:#F3E6CC;
}
body{margin:0;font-family:Montserrat,Arial;background:#fff;color:#333}
header{text-align:center;padding:15px;border-bottom:1px solid #ddd}
nav{display:flex;justify-content:center;gap:12px;padding:10px;background:var(--vinho);flex-wrap:wrap}
nav button{background:none;color:#fff;border:none;font-size:14px;cursor:pointer}
.page{display:none;padding:15px}
.page.active{display:block}
footer{text-align:center;padding:8px;font-size:13px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;font-size:13px;vertical-align:top}
th{background:var(--bege-claro)}
th button{background:none;border:none;font-weight:600;cursor:pointer}
.card{border-left:4px solid var(--vinho);padding:8px;margin-bottom:6px;background:#fafafa}
button.small{font-size:12px;padding:3px 6px}
input,select{width:95%}
</style>
</head>

<body>

<header>
  <h2>S√çTIO C√ìRREGO DO PINHAL</h2>
  <div>Fam√≠lia Ribeiro</div>
  <div id="dataHoje"></div>
</header>

<nav>
  <button onclick="abrir('home')">In√≠cio</button>
  <button onclick="abrir('vacas')">Vacas</button>
  <button onclick="abrir('crias')">Crias</button>
  <button onclick="abrir('historico')">Hist√≥rico de Crias</button>
  <button onclick="abrir('bezerros')">Bezerros(as)</button>
</nav>

<footer>
  <span onclick="login()" style="cursor:pointer">‚öôÔ∏è Administrador</span>
</footer>

<section id="home" class="page active">
  <h3>Vacas a Criar</h3>
  <div id="homeLista"></div>
</section>

<section id="vacas" class="page">
  <h3>Vacas</h3>
  <table id="tVacas"></table>
</section>

<section id="crias" class="page">
  <h3>Crias (Gesta√ß√£o Atual)</h3>
  <table id="tCrias"></table>
</section>

<section id="historico" class="page">
  <h3>Hist√≥rico de Crias</h3>
  <table id="tHistorico"></table>
</section>

<section id="bezerros" class="page">
  <h3>Bezerros(as)</h3>
  <table id="tBezerros"></table>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

/* ESTADO */
let dados=[], bezerros=[], admin=false;
const hoje=new Date();
document.getElementById("dataHoje").innerText="Data atual: "+hoje.toLocaleDateString("pt-BR");

/* LOGIN */
window.login=async()=>{
  const email=prompt("Email admin");
  const senha=prompt("Senha");
  try{
    await signInWithEmailAndPassword(auth,email,senha);
    admin=true;
    montarTudo();
    alert("Administrador ativo");
  }catch{alert("Login inv√°lido")}
};

/* NAVEGA√á√ÉO */
window.abrir=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

/* UTIL */
const data=d=>new Date(d.split("/").reverse().join("-"));
function idade(nasc){
  const dn=data(nasc);
  let anos=hoje.getFullYear()-dn.getFullYear();
  let meses=hoje.getMonth()-dn.getMonth();
  if(meses<0){anos--;meses+=12}
  return `${anos} ano${anos!==1?"s":""} e ${meses} mes${meses!==1?"es":""}`;
}

/* CARREGAR */
async function carregar(){
  dados=(await getDocs(collection(db,"vacas"))).docs.map(d=>({id:d.id,...d.data()}));
  bezerros=(await getDocs(collection(db,"bezerros"))).docs.map(d=>({id:d.id,...d.data()}));
  montarTudo();
}

/* HOME */
function montarHome(){
  const h=document.getElementById("homeLista");
  h.innerHTML="";
  dados.filter(d=>!d.criouDia&&d.criaEm)
    .sort((a,b)=>data(a.criaEm)-data(b.criaEm))
    .forEach(d=>{
      const dias=Math.ceil((data(d.criaEm)-hoje)/86400000);
      h.innerHTML+=`
        <div class="card">
          <strong>${d.nome}</strong> ‚Äì ${d.touro||"-"} ‚Äì ${d.criaEm} ‚Äì faltam ${dias} dias
        </div>`;
    });
}

/* VACAS */
function montarVacas(){
  let h=`<tr>
    <th>Nome</th><th>Ra√ßa</th><th>Touro</th><th>Panhou cria</th><th>Parto previsto</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  dados.forEach(d=>{
    h+=`<tr>
      <td>${d.nome||""}</td>
      <td>${d.raca||""}</td>
      <td>${d.touro||""}</td>
      <td>${d.panhou||""}</td>
      <td>${d.criaEm||""}</td>
      ${admin?`
      <td>
        <button class="small" onclick="editar('${d.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluir('${d.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  document.getElementById("tVacas").innerHTML=h;
}

/* CRIAS */
function montarCrias(){
  let h=`<tr>
    <th>Vaca</th><th>Touro</th><th>Panhou cria</th><th>Parto previsto</th>
  </tr>`;
  dados.filter(d=>!d.criouDia).forEach(d=>{
    h+=`<tr>
      <td>${d.nome}</td>
      <td>${d.touro||""}</td>
      <td>${d.panhou||""}</td>
      <td>${d.criaEm||""}</td>
    </tr>`;
  });
  document.getElementById("tCrias").innerHTML=h;
}

/* HIST√ìRICO */
function montarHistorico(){
  let h=`<tr>
    <th>Vaca</th><th>Touro</th><th>Data do parto</th><th>Nome da cria</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  dados.filter(d=>d.criouDia).forEach(d=>{
    h+=`<tr>
      <td>${d.nome}</td>
      <td>${d.touro||""}</td>
      <td>${d.criouDia}</td>
      <td>${d.nomeCria}</td>
      ${admin?`
      <td>
        <button class="small" onclick="editarHistorico('${d.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluir('${d.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  document.getElementById("tHistorico").innerHTML=h;
}

/* BEZERROS */
function montarBezerros(){
  let h=`<tr>
    <th>Nome</th><th>Sexo</th><th>M√£e</th><th>Nascimento</th><th>Idade</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  bezerros.forEach(b=>{
    h+=`<tr>
      <td>${b.nome}</td>
      <td>${b.sexo}</td>
      <td>${b.mae}</td>
      <td>${b.nascimento}</td>
      <td>${idade(b.nascimento)}</td>
      ${admin?`
      <td>
        <button class="small" onclick="editarBezerro('${b.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluirBezerro('${b.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  document.getElementById("tBezerros").innerHTML=h;
}

/* CRUD */
window.editar=async id=>{
  const d=dados.find(x=>x.id===id);
  await updateDoc(doc(db,"vacas",id),{
    touro:prompt("Touro",d.touro||""),
    panhou:prompt("Panhou cria",d.panhou||""),
    criaEm:prompt("Parto previsto",d.criaEm||"")
  });
  carregar();
};

window.editarHistorico=async id=>{
  const d=dados.find(x=>x.id===id);
  await updateDoc(doc(db,"vacas",id),{
    touro:prompt("Touro",d.touro||""),
    criouDia:prompt("Data do parto",d.criouDia||""),
    nomeCria:prompt("Nome da cria",d.nomeCria||"")
  });
  carregar();
};

window.editarBezerro=async id=>{
  const b=bezerros.find(x=>x.id===id);
  await updateDoc(doc(db,"bezerros",id),{
    nome:prompt("Nome",b.nome),
    sexo:prompt("Sexo (M/F)",b.sexo),
    mae:prompt("M√£e",b.mae),
    nascimento:prompt("Nascimento",b.nascimento)
  });
  carregar();
};

window.excluir=async id=>{
  if(confirm("Excluir registro?")){
    await deleteDoc(doc(db,"vacas",id));
    carregar();
  }
};

window.excluirBezerro=async id=>{
  if(confirm("Excluir bezerro?")){
    await deleteDoc(doc(db,"bezerros",id));
    carregar();
  }
};

function montarTudo(){
  montarHome();
  montarVacas();
  montarCrias();
  montarHistorico();
  montarBezerros();
}

carregar();
</script>

</body>
</html>
