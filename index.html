<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S√≠tio C√≥rrego do Pinhal</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --vinho:#7A1E2C;
  --vinho-escuro:#5E1622;
  --bege:#D8B98A;
  --bege-claro:#F3E6CC;
}
body{margin:0;font-family:Montserrat,Arial;background:#fff;color:#333}
header{text-align:center;padding:15px;border-bottom:1px solid #ddd}
nav{display:flex;justify-content:center;gap:12px;padding:12px;background:var(--vinho)}
nav button{background:none;color:#fff;border:none;font-size:14px;cursor:pointer}
nav button:hover{text-decoration:underline}
.page{display:none;padding:20px}
.page.active{display:block}
footer{text-align:center;padding:10px;font-size:13px}
.card{border-left:5px solid var(--vinho);padding:10px;margin-bottom:8px;background:#fafafa}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;font-size:14px}
th{background:var(--bege-claro);cursor:pointer}
th:hover{background:#e9dbbf}
.admin-only{display:none}
body.admin .admin-only{display:inline}
button.small{font-size:12px;padding:4px 8px}
</style>
</head>

<body>

<header>
  <h2>S√çTIO C√ìRREGO DO PINHAL</h2>
  <div>Fam√≠lia Ribeiro</div>
  <div id="dataHoje"></div>
</header>

<nav>
  <button onclick="abrir('home')">In√≠cio</button>
  <button onclick="abrir('vacas')">Vacas</button>
  <button onclick="abrir('crias')">Crias</button>
  <button onclick="abrir('historico')">Hist√≥rico de Crias</button>
</nav>

<footer>
  <span onclick="login()" style="cursor:pointer">‚öôÔ∏è Administrador</span>
</footer>

<section id="home" class="page active">
  <h3>Vacas a Criar</h3>
  <div id="homeLista"></div>
</section>

<section id="vacas" class="page">
  <h3>Vacas</h3>
  <table id="tVacas"></table>
</section>

<section id="crias" class="page">
  <h3>Crias (Gesta√ß√£o Atual)</h3>
  <table id="tCrias"></table>
</section>

<section id="historico" class="page">
  <h3>Hist√≥rico de Crias</h3>
  <table id="tHistorico"></table>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

/* ESTADO */
let dados=[];
let admin=false;
let ordem={};

/* LOGIN */
window.login=async()=>{
  const email=prompt("Email admin");
  const senha=prompt("Senha");
  try{
    await signInWithEmailAndPassword(auth,email,senha);
    admin=true;
    document.body.classList.add("admin");
    montarTudo();
    alert("Administrador ativo");
  }catch{alert("Login inv√°lido")}
};

/* NAVEGA√á√ÉO */
window.abrir=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

document.getElementById("dataHoje").innerText=
  "Data atual: "+new Date().toLocaleDateString("pt-BR");

/* CARREGAR */
async function carregar(){
  const snap=await getDocs(collection(db,"vacas"));
  dados=snap.docs.map(d=>({id:d.id,...d.data()}));
  montarTudo();
}

/* ORDENA√á√ÉO */
function ordenar(campo){
  ordem[campo]=!ordem[campo];
  dados.sort((a,b)=>{
    let x=a[campo]||"", y=b[campo]||"";
    if(campo.includes("Em")||campo.includes("Dia")){
      x=data(x); y=data(y);
      return ordem[campo]?x-y:y-x;
    }
    return ordem[campo]?x.localeCompare(y):y.localeCompare(x);
  });
  montarTudo();
}

/* HOME */
function montarHome(){
  const h=document.getElementById("homeLista");
  h.innerHTML="";
  dados.filter(d=>!d.criouDia&&d.criaEm)
    .sort((a,b)=>data(a.criaEm)-data(b.criaEm))
    .forEach(d=>{
      const dias=Math.ceil((data(d.criaEm)-new Date())/86400000);
      h.innerHTML+=`
        <div class="card">
          <strong>${d.nome}</strong> ‚Äì ${d.touro||"-"} ‚Äì ${d.criaEm} ‚Äì faltam ${dias} dias
        </div>`;
    });
}

/* VACAS */
function montarVacas(){
  let h=`
  <tr>
    <th onclick="ordenar('nome')">Nome</th>
    <th onclick="ordenar('raca')">Ra√ßa</th>
    <th onclick="ordenar('touro')">Touro</th>
    <th onclick="ordenar('panhou')">Panhou</th>
    <th onclick="ordenar('criaEm')">Previsto</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  dados.forEach(d=>{
    h+=`
    <tr>
      <td>${d.nome||""}</td>
      <td>${d.raca||""}</td>
      <td>${d.touro||""}</td>
      <td>${d.panhou||""}</td>
      <td>${d.criaEm||""}</td>
      ${admin?`
      <td>
        <button class="small" onclick="editar('${d.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluir('${d.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  document.getElementById("tVacas").innerHTML=h;
}

/* CRIAS */
function montarCrias(){
  let h=`
  <tr>
    <th onclick="ordenar('nome')">Vaca</th>
    <th onclick="ordenar('touro')">Touro</th>
    <th onclick="ordenar('panhou')">Panhou</th>
    <th onclick="ordenar('criaEm')">Previsto</th>
  </tr>`;
  dados.filter(d=>!d.criouDia).forEach(d=>{
    h+=`
    <tr>
      <td>${d.nome}</td>
      <td>${d.touro||""}</td>
      <td>${d.panhou||""}</td>
      <td>${d.criaEm||""}</td>
    </tr>`;
  });
  document.getElementById("tCrias").innerHTML=h;
}

/* HIST√ìRICO */
function montarHistorico(){
  let h=`
  <tr>
    <th onclick="ordenar('nome')">Vaca</th>
    <th onclick="ordenar('touro')">Touro</th>
    <th onclick="ordenar('criouDia')">Parto</th>
    <th onclick="ordenar('nomeCria')">Cria</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  dados.filter(d=>d.criouDia).forEach(d=>{
    h+=`
    <tr>
      <td>${d.nome}</td>
      <td>${d.touro||""}</td>
      <td>${d.criouDia}</td>
      <td>${d.nomeCria}</td>
      ${admin?`
      <td>
        <button class="small" onclick="editarHistorico('${d.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluir('${d.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  document.getElementById("tHistorico").innerHTML=h;
}

/* CRUD */
window.editar=async id=>{
  const d=dados.find(x=>x.id===id);
  const touro=prompt("Touro",d.touro||"");
  const panhou=prompt("Panhou",d.panhou||"");
  const cria=prompt("Previsto",d.criaEm||"");
  await updateDoc(doc(db,"vacas",id),{touro,panhou,criaEm:cria});
  carregar();
};

window.editarHistorico=async id=>{
  const d=dados.find(x=>x.id===id);
  const touro=prompt("Touro",d.touro||"");
  const parto=prompt("Parto",d.criouDia||"");
  const cria=prompt("Cria",d.nomeCria||"");
  await updateDoc(doc(db,"vacas",id),{touro,criouDia:parto,nomeCria:cria});
  carregar();
};

window.excluir=async id=>{
  if(confirm("Excluir registro?")){
    await deleteDoc(doc(db,"vacas",id));
    carregar();
  }
};

const data=d=>new Date(d.split("/").reverse().join("-"));
function montarTudo(){montarHome();montarVacas();montarCrias();montarHistorico()}
carregar();
</script>

</body>
</html>
