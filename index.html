<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S√≠tio C√≥rrego do Pinhal</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --vinho:#7A1E2C;
  --bege-claro:#F3E6CC;
}
body{margin:0;font-family:Montserrat,Arial;background:#fff;color:#333}
header{text-align:center;padding:15px;border-bottom:1px solid #ddd}
nav{display:flex;justify-content:center;gap:12px;padding:10px;background:var(--vinho);flex-wrap:wrap}
nav button{background:none;color:#fff;border:none;font-size:14px;cursor:pointer}
.page{display:none;padding:15px}
.page.active{display:block}
footer{text-align:center;padding:8px;font-size:13px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;font-size:13px}
th{background:var(--bege-claro)}
th button{background:none;border:none;font-weight:600;cursor:pointer}
.card{border-left:4px solid var(--vinho);padding:8px;margin-bottom:6px;background:#fafafa}
button.small{font-size:12px;padding:3px 6px}
input,select{width:95%}
</style>
</head>

<body>

<header>
  <h2>S√çTIO C√ìRREGO DO PINHAL</h2>
  <div>Fam√≠lia Ribeiro</div>
  <div id="dataHoje"></div>
</header>

<nav>
  <button onclick="abrir('home')">In√≠cio</button>
  <button onclick="abrir('vacas')">Vacas</button>
  <button onclick="abrir('crias')">Crias</button>
  <button onclick="abrir('historico')">Hist√≥rico de Crias</button>
  <button onclick="abrir('bezerros')">Bezerros(as)</button>
</nav>

<footer>
  <span onclick="login()" style="cursor:pointer">‚öôÔ∏è Administrador</span>
</footer>

<section id="home" class="page active">
  <h3>Vacas a Criar</h3>
  <div id="homeLista"></div>
</section>

<section id="vacas" class="page">
  <h3>Vacas</h3>
  <table id="tVacas"></table>
</section>

<section id="crias" class="page">
  <h3>Crias (Gesta√ß√£o Atual)</h3>
  <table id="tCrias"></table>
</section>

<section id="historico" class="page">
  <h3>Hist√≥rico de Crias</h3>
  <table id="tHistorico"></table>
</section>

<section id="bezerros" class="page">
  <h3>Bezerros(as)</h3>
  <table id="tBezerros"></table>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig={
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

let dados=[], bezerros=[], admin=false;

const hoje=new Date();
document.getElementById("dataHoje").innerText="Data atual: "+hoje.toLocaleDateString("pt-BR");

window.login=async()=>{
  const email=prompt("Email admin");
  const senha=prompt("Senha");
  try{
    await signInWithEmailAndPassword(auth,email,senha);
    admin=true;
    montarTudo();
    alert("Administrador ativo");
  }catch{alert("Login inv√°lido")}
};

window.abrir=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

const data=d=>new Date(d.split("/").reverse().join("-"));

function idade(nasc){
  const dn=data(nasc);
  let anos=hoje.getFullYear()-dn.getFullYear();
  let meses=hoje.getMonth()-dn.getMonth();
  if(meses<0){anos--;meses+=12}
  return `${anos} ano${anos!==1?"s":""} e ${meses} mes${meses!==1?"es":""}`;
}

async function carregar(){
  dados=(await getDocs(collection(db,"vacas"))).docs.map(d=>({id:d.id,...d.data()}));
  bezerros=(await getDocs(collection(db,"bezerros"))).docs.map(d=>({id:d.id,...d.data()}));
  montarTudo();
}

function montarHome(){
  const h=document.getElementById("homeLista");
  h.innerHTML="";
  dados.filter(d=>!d.criouDia&&d.criaEm)
    .sort((a,b)=>data(a.criaEm)-data(b.criaEm))
    .forEach(d=>{
      const dias=Math.ceil((data(d.criaEm)-hoje)/86400000);
      h.innerHTML+=`<div class="card"><strong>${d.nome}</strong> ‚Äì ${d.touro||"-"} ‚Äì ${d.criaEm} ‚Äì faltam ${dias} dias</div>`;
    });
}

function montarBezerros(){
  let h=`<tr>
    <th>Nome</th><th>Sexo</th><th>M√£e</th><th>Nascimento</th><th>Idade</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  bezerros.forEach(b=>{
    h+=`<tr>
      <td>${b.nome}</td>
      <td>${b.sexo}</td>
      <td>${b.mae}</td>
      <td>${b.nascimento}</td>
      <td>${idade(b.nascimento)}</td>
      ${admin?`<td>
        <button class="small" onclick="editarBezerro('${b.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluirBezerro('${b.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  if(admin){
    h+=`<tr>
      <td><input id="bnome"></td>
      <td>
        <select id="bsexo"><option>M</option><option>F</option></select>
      </td>
      <td>
        <select id="bmae">
          ${dados.map(v=>`<option>${v.nome}</option>`).join("")}
        </select>
      </td>
      <td><input id="bnasc" placeholder="DD/MM/AAAA"></td>
      <td>-</td>
      <td><button onclick="addBezerro()">‚ûï</button></td>
    </tr>`;
  }
  document.getElementById("tBezerros").innerHTML=h;
}

window.addBezerro=async()=>{
  await addDoc(collection(db,"bezerros"),{
    nome:bnome.value,
    sexo:bsexo.value,
    mae:bmae.value,
    nascimento:bnasc.value
  });
  carregar();
};

window.editarBezerro=async id=>{
  const b=bezerros.find(x=>x.id===id);
  await updateDoc(doc(db,"bezerros",id),{
    nome:prompt("Nome",b.nome),
    sexo:prompt("Sexo (M/F)",b.sexo),
    mae:prompt("M√£e",b.mae),
    nascimento:prompt("Nascimento",b.nascimento)
  });
  carregar();
};

window.excluirBezerro=async id=>{
  if(confirm("Excluir bezerro?")){
    await deleteDoc(doc(db,"bezerros",id));
    carregar();
  }
};

function montarTudo(){
  montarHome();
  montarBezerros();
}

carregar();
</script>

</body>
</html>
