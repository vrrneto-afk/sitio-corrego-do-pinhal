<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S√≠tio C√≥rrego do Pinhal</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --vinho:#7A1E2C;
  --bege-claro:#F3E6CC;
}
body{margin:0;font-family:Montserrat,Arial;background:#fff;color:#333}
header{text-align:center;padding:15px;border-bottom:1px solid #ddd}
nav{display:flex;justify-content:center;gap:12px;padding:10px;background:var(--vinho);flex-wrap:wrap}
nav button{background:none;color:#fff;border:none;font-size:14px;cursor:pointer}
.page{display:none;padding:15px}
.page.active{display:block}
footer{text-align:center;padding:8px;font-size:13px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;font-size:13px;vertical-align:top}
th{background:var(--bege-claro)}
th button{background:none;border:none;font-weight:600;cursor:pointer}
.card{border-left:4px solid var(--vinho);padding:8px;margin-bottom:6px;background:#fafafa}
button.small{font-size:12px;padding:3px 6px}
input,select{width:95%}
</style>
</head>

<body>

<header>
  <h2>S√çTIO C√ìRREGO DO PINHAL</h2>
  <div>Fam√≠lia Ribeiro</div>
  <div id="dataHoje"></div>
</header>

<nav>
  <button onclick="abrir('home')">In√≠cio</button>
  <button onclick="abrir('vacas')">Vacas</button>
  <button onclick="abrir('crias')">Crias</button>
  <button onclick="abrir('historico')">Hist√≥rico de Crias</button>
  <button onclick="abrir('bezerros')">Bezerros(as)</button>
  <button onclick="abrir('vacinacao')">Vacina√ß√£o</button>
</nav>

<footer>
  <span onclick="login()" style="cursor:pointer">‚öôÔ∏è Administrador</span>
</footer>

<section id="home" class="page active">
  <h3>Vacas a Criar</h3>
  <div id="homeLista"></div>
</section>

<section id="vacas" class="page">
  <h3>Vacas</h3>
  <table id="tVacas"></table>
</section>

<section id="crias" class="page">
  <h3>Crias (Gesta√ß√£o Atual)</h3>
  <table id="tCrias"></table>
</section>

<section id="historico" class="page">
  <h3>Hist√≥rico de Crias</h3>
  <table id="tHistorico"></table>
</section>

<section id="bezerros" class="page">
  <h3>Bezerros(as)</h3>
  <table id="tBezerros"></table>
</section>

<section id="vacinacao" class="page">
  <h3>Vacina√ß√£o</h3>
  <table id="tVacinacao"></table>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

/* ESTADO */
let dados=[], bezerros=[], vacinacoes=[], admin=false;
const hoje=new Date();
document.getElementById("dataHoje").innerText="Data atual: "+hoje.toLocaleDateString("pt-BR");

/* LOGIN */
window.login=async()=>{
  const email=prompt("Email admin");
  const senha=prompt("Senha");
  try{
    await signInWithEmailAndPassword(auth,email,senha);
    admin=true;
    montarTudo();
    alert("Administrador ativo");
  }catch{alert("Login inv√°lido")}
};

/* NAVEGA√á√ÉO */
window.abrir=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

/* UTIL */
const data=d=>new Date(d.split("/").reverse().join("-"));
function idade(nasc){
  const dn=data(nasc);
  let anos=hoje.getFullYear()-dn.getFullYear();
  let meses=hoje.getMonth()-dn.getMonth();
  if(meses<0){anos--;meses+=12}
  return `${anos} ano${anos!==1?"s":""} e ${meses} mes${meses!==1?"es":""}`;
}

/* CARREGAR */
async function carregar(){
  dados=(await getDocs(collection(db,"vacas"))).docs.map(d=>({id:d.id,...d.data()}));
  bezerros=(await getDocs(collection(db,"bezerros"))).docs.map(d=>({id:d.id,...d.data()}));
  vacinacoes=(await getDocs(collection(db,"vacinacao"))).docs.map(d=>({id:d.id,...d.data()}));
  montarTudo();
}

/* HOME */
function montarHome(){
  const h=document.getElementById("homeLista");
  h.innerHTML="";
  dados.filter(d=>!d.criouDia&&d.criaEm)
    .sort((a,b)=>data(a.criaEm)-data(b.criaEm))
    .forEach(d=>{
      const dias=Math.ceil((data(d.criaEm)-hoje)/86400000);
      h.innerHTML+=`
        <div class="card">
          <strong>${d.nome}</strong> ‚Äì ${d.touro||"-"} ‚Äì ${d.criaEm} ‚Äì faltam ${dias} dias
        </div>`;
    });
}

/* VACINACAO */
function montarVacinacao(){
  let h=`<tr>
    <th>Animal</th><th>Vacina</th><th>Data</th><th>Observa√ß√£o</th>
    ${admin?"<th>A√ß√µes</th>":""}
  </tr>`;
  vacinacoes.forEach(v=>{
    h+=`<tr>
      <td>${v.animal}</td>
      <td>${v.vacina}</td>
      <td>${v.data}</td>
      <td>${v.observacao}</td>
      ${admin?`
      <td>
        <button class="small" onclick="editarVacina('${v.id}')">‚úèÔ∏è</button>
        <button class="small" onclick="excluirVacina('${v.id}')">üóëÔ∏è</button>
      </td>`:""}
    </tr>`;
  });
  if(admin){
    h+=`<tr>
      <td><select id="vacaBezerro">
        ${[...dados,...bezerros].map(a=>`<option>${a.nome}</option>`).join("")}
      </select></td>
      <td><input id="vacina" placeholder="Vacina aplicada"></td>
      <td><input id="dataVacina" placeholder="DD/MM/AAAA"></td>
      <td><input id="observacao" placeholder="Observa√ß√£o"></td>
      <td><button onclick="addVacina()">‚ûï</button></td>
    </tr>`;
  }
  document.getElementById("tVacinacao").innerHTML=h;
}

window.addVacina=async()=>{
  await addDoc(collection(db,"vacinacao"),{
    animal:vacaBezerro.value,
    vacina:vacina.value,
    data:dataVacina.value,
    observacao:observacao.value
  });
  carregar();
};

window.editarVacina=async id=>{
  const v=vacinacoes.find(x=>x.id===id);
  await updateDoc(doc(db,"vacinacao",id),{
    vacina:prompt("Vacina",v.vacina),
    data:prompt("Data da vacina",v.data),
    observacao:prompt("Observa√ß√£o",v.observacao)
  });
  carregar();
};

window.excluirVacina=async id=>{
  if(confirm("Excluir vacina?")){
    await deleteDoc(doc(db,"vacinacao",id));
    carregar();
  }
};

/* MONTAR TUDO */
function montarTudo(){
  montarHome();
  montarVacas();
  montarCrias();
  montarHistorico();
  montarBezerros();
  montarVacinacao();
}

carregar();
</script>

</body>
</html>
