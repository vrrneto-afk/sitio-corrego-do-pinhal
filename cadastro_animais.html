<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro de Animais</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --marrom:#7b3f2a;
  --bege:#f3e6d8;
  --verde:#2f6b2f;
  --vermelho:#b03a2e;
}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--bege)}

header{
  background:var(--marrom);
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:bold
}

.menu{
  display:flex;
  gap:8px;
  justify-content:center;
  background:#eee;
  padding:10px;
  flex-wrap:wrap
}
.menu button{
  padding:10px 14px;
  border:none;
  border-radius:6px;
  background:#ddd;
  font-weight:bold;
  cursor:pointer
}
.menu button.active{background:#fff}

.container{
  max-width:720px;
  margin:20px auto;
  padding:18px;
  background:#fff;
  border-radius:10px;
}

label{font-weight:bold;margin-top:12px;display:block}
input,select,textarea{
  width:100%;
  padding:10px;
  margin-top:6px
}
textarea{resize:vertical}

button.action{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  font-size:16px;
  cursor:pointer;
  border-radius:6px
}
.salvar{background:var(--verde);color:#fff}
.excluir{background:var(--vermelho);color:#fff}
.hidden{display:none}
</style>
</head>

<body>

<header>üêÑ Administra√ß√£o ‚Ä¢ Animais</header>

<div class="menu">
  <button class="active">Animais</button>
  <button onclick="location.href='cadastro_vacinas.html'">Vacinas</button>
  <button onclick="location.href='cadastro_leite.html'">Leite</button>
  <button onclick="location.href='cadastro_despesas.html'">Despesas</button>
  <button onclick="location.href='cadastro_eventos.html'">Eventos</button>
  <button onclick="logout()">Sair</button>
</div>

<div class="container">
  <h2>Cadastro de Animais</h2>

  <label>A√ß√£o</label>
  <select id="acao">
    <option value="novo">‚ûï Novo registro</option>
    <option value="editar">‚úèÔ∏è Editar registro</option>
  </select>

  <div id="blocoEditar" class="hidden">
    <label>Animal cadastrado</label>
    <select id="animalExistente"></select>
  </div>

  <label>ID Animal</label>
  <input id="id_animal">

  <label>Nome</label>
  <input id="nome">

  <label>Esp√©cie</label>
  <select id="especie">
    <option>Bovino</option>
  </select>

  <label>Ra√ßa</label>
  <input id="raca">

  <label>Sexo</label>
  <select id="sexo">
    <option value="F">F√™mea</option>
    <option value="M">Macho</option>
  </select>

  <label>Data de nascimento</label>
  <input type="date" id="data_nascimento">

  <label>Idade (meses)</label>
  <input id="idade_meses" type="number">

  <label>Origem</label>
  <select id="origem">
    <option>Nascido</option>
    <option>Comprado</option>
  </select>

  <label>ID M√£e</label>
  <input id="id_mae">

  <label>ID Pai</label>
  <input id="id_pai">

  <label>Status</label>
  <select id="status">
    <option>Ativo</option>
    <option>Inativo</option>
  </select>

  <label>Observa√ß√µes</label>
  <textarea id="observacoes"></textarea>

  <button class="action salvar" onclick="salvar()">üíæ Salvar</button>
  <button class="action excluir hidden" id="btnExcluir" onclick="excluir()">üóëÔ∏è Excluir</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
});

const auth = firebase.auth();
const db = firebase.firestore();

let animais=[], atual=null;

auth.onAuthStateChanged(u=>{
  if(!u) location.href="admin.html";
  carregarAnimais();
});

acao.onchange = ()=>{
  const editar = acao.value==="editar";
  blocoEditar.classList.toggle("hidden", !editar);
  btnExcluir.classList.toggle("hidden", !editar);
  limpar();
};

async function carregarAnimais(){
  const snap = await db.collection("animais").get();
  animais = snap.docs.map(d=>({id:d.id,...d.data()}))
    .sort((a,b)=>a.nome.localeCompare(b.nome,'pt-BR'));

  animalExistente.innerHTML = `<option value="">Selecione</option>`;
  animais.forEach(a=>{
    animalExistente.innerHTML += `<option value="${a.id}">${a.nome}</option>`;
  });
}

animalExistente.onchange = ()=>{
  atual = animais.find(a=>a.id===animalExistente.value);
  if(!atual) return;

  id_animal.value = atual.id_animal;
  nome.value = atual.nome;
  especie.value = atual.especie;
  raca.value = atual.raca;
  sexo.value = atual.sexo;
  data_nascimento.value = atual.data_nascimento;
  idade_meses.value = atual.idade_meses;
  origem.value = atual.origem;
  id_mae.value = atual.id_mae;
  id_pai.value = atual.id_pai;
  status.value = atual.status;
  observacoes.value = atual.observacoes || "";
};

async function salvar(){
  const dados = {
    id_animal: id_animal.value,
    nome: nome.value,
    especie: especie.value,
    raca: raca.value,
    sexo: sexo.value,
    data_nascimento: data_nascimento.value,
    idade_meses: idade_meses.value,
    origem: origem.value,
    id_mae: id_mae.value,
    id_pai: id_pai.value,
    status: status.value,
    observacoes: observacoes.value,
    criado_em: new Date().toISOString().slice(0,10)
  };

  if(acao.value==="novo"){
    await db.collection("animais").add(dados);
  }else{
    await db.collection("animais").doc(atual.id).update(dados);
  }

  alert("Salvo com sucesso");
  location.reload();
}

async function excluir(){
  if(confirm("Excluir animal?")){
    await db.collection("animais").doc(atual.id).delete();
    location.reload();
  }
}

function limpar(){
  document.querySelectorAll("input,textarea").forEach(e=>e.value="");
  especie.value="Bovino";
  status.value="Ativo";
}

function logout(){
  auth.signOut().then(()=>location.href="admin.html");
}
</script>
</body>
</html>
