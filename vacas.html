<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vacas</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f4f4;
}

header {
  text-align: center;
  padding: 20px;
  font-size: 28px;
  font-weight: bold;
}

nav {
  background: #7a1f2b;
  padding: 10px;
  text-align: center;
}

nav a {
  color: white;
  margin: 0 10px;
  text-decoration: none;
  font-weight: bold;
}

.container {
  padding: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}

th {
  cursor: pointer;
  background: #eee;
}

th:hover {
  background: #ddd;
}

tr.selecionada {
  background: #fde2e2;
}

button {
  padding: 8px 12px;
  margin: 5px;
  background: #7a1f2b;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}

#adminBar {
  display: none;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<header>S√≠tio C√≥rrego do Pinhal</header>

<nav>
  <a href="index.html">In√≠cio</a>
  <a href="vacas.html">Vacas</a>
  <a href="historico.html">Hist√≥rico</a>
  <a href="bezerros.html">Bezerros</a>
  <a href="vacinas.html">Vacinas</a>
  <a href="animais.html">Animais</a>
</nav>

<div class="container">

<h2>Vacas</h2>

<div id="adminBar">
  <button onclick="adicionar()">Adicionar vaca</button>
  <button onclick="editar()">Editar selecionada</button>
  <button onclick="excluir()">Excluir selecionada</button>
</div>

<table>
<thead>
<tr>
  <th data-col="nome">Nome</th>
  <th data-col="raca">Ra√ßa</th>
  <th data-col="touro">Touro</th>
  <th data-col="panhou_cria_em">Panhou cria</th>
  <th data-col="cria_prevista_em">Cria prevista</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  // üî¥ MANTENHA SUA CONFIGURA√á√ÉO AQUI
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let dados = [];
let selecionado = null;
let ordemColuna = {};
let colunaAtual = null;

// ---------- CARREGAR DADOS ----------
db.collection("vacas").onSnapshot(snapshot => {
  dados = [];
  snapshot.forEach(doc => {
    dados.push({ id: doc.id, ...doc.data() });
  });
  renderTabela(dados);
});

// ---------- RENDER ----------
function renderTabela(lista) {
  const tbody = document.getElementById("tabela");
  tbody.innerHTML = "";
  lista.forEach(v => {
    const tr = document.createElement("tr");
    tr.onclick = () => selecionar(tr, v);
    tr.innerHTML = `
      <td>${v.nome || ""}</td>
      <td>${v.raca || ""}</td>
      <td>${v.touro || ""}</td>
      <td>${formatarData(v.panhou_cria_em)}</td>
      <td>${formatarData(v.cria_prevista_em)}</td>
    `;
    tbody.appendChild(tr);
  });
}

// ---------- SELE√á√ÉO ----------
function selecionar(tr, dado) {
  document.querySelectorAll("tr").forEach(r => r.classList.remove("selecionada"));
  tr.classList.add("selecionada");
  selecionado = dado;
}

// ---------- CRUD ----------
function adicionar() {
  const nome = prompt("Nome:");
  if (!nome) return;

  db.collection("vacas").add({
    nome,
    raca: prompt("Ra√ßa:"),
    touro: prompt("Touro:"),
    panhou_cria_em: prompt("Panhou cria (DD/MM/AAAA):"),
    cria_prevista_em: prompt("Cria prevista (DD/MM/AAAA):"),
    ativo: true
  });
}

function editar() {
  if (!selecionado) return alert("Selecione uma vaca");

  db.collection("vacas").doc(selecionado.id).update({
    nome: prompt("Nome:", selecionado.nome),
    raca: prompt("Ra√ßa:", selecionado.raca),
    touro: prompt("Touro:", selecionado.touro),
    panhou_cria_em: prompt("Panhou cria:", selecionado.panhou_cria_em),
    cria_prevista_em: prompt("Cria prevista:", selecionado.cria_prevista_em)
  });
}

function excluir() {
  if (!selecionado) return alert("Selecione uma vaca");
  if (confirm("Deseja excluir?")) {
    db.collection("vacas").doc(selecionado.id).delete();
  }
}

// ---------- ORDENA√á√ÉO ----------
function parseDataBR(d) {
  if (!d) return null;
  const [dia, mes, ano] = d.split("/");
  return new Date(ano, mes - 1, dia);
}

document.querySelectorAll("th").forEach(th => {
  th.onclick = () => {
    const col = th.dataset.col;
    if (colunaAtual !== col) {
      ordemColuna[col] = true;
      colunaAtual = col;
    } else {
      ordemColuna[col] = !ordemColuna[col];
    }

    const crescente = ordemColuna[col];

    dados.sort((a, b) => {
      let A = a[col] || "";
      let B = b[col] || "";

      if (col.includes("em")) {
        const dA = parseDataBR(A);
        const dB = parseDataBR(B);
        if (!dA && !dB) return 0;
        if (!dA) return 1;
        if (!dB) return -1;
        return crescente ? dA - dB : dB - dA;
      }

      return crescente
        ? A.localeCompare(B)
        : B.localeCompare(A);
    });

    renderTabela(dados);
  };
});

// ---------- ADM ----------
const senhaADM = "1234"; // üî¥ altere depois

const engrenagem = document.createElement("div");
engrenagem.innerHTML = "‚öôÔ∏è";
engrenagem.style.position = "fixed";
engrenagem.style.bottom = "20px";
engrenagem.style.right = "20px";
engrenagem.style.fontSize = "28px";
engrenagem.style.cursor = "pointer";
document.body.appendChild(engrenagem);

engrenagem.onclick = () => {
  const senha = prompt("Senha ADM:");
  if (senha === senhaADM) {
    document.getElementById("adminBar").style.display = "block";
  } else {
    alert("Senha incorreta");
  }
};

// ---------- UTIL ----------
function formatarData(d) {
  return d || "";
}
</script>

</body>
</html>
