<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Vacas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial,sans-serif}
header{text-align:center;padding:10px}
nav{background:#7A1E2C;padding:10px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
nav a{color:#fff;text-decoration:none;padding:6px 10px;border-radius:5px}
nav a:hover{background:#5e1622}
main{padding:15px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;font-size:14px}
th{cursor:pointer;background:#f3f3f3}
.admin-only{display:none}
body.admin .admin-only{display:inline}
@media(max-width:600px){th,td{font-size:12px}}
</style>
</head>

<body>

<header>
  <h2>S√≠tio C√≥rrego do Pinhal</h2>
</header>

<nav>
  <a href="index.html">In√≠cio</a>
  <a href="vacas.html">Vacas</a>
  <a href="crias.html">Crias</a>
  <a href="historico.html">Hist√≥rico</a>
  <a href="bezerros.html">Bezerros</a>
  <a href="animais.html">Animais</a>
  <a href="vacinas.html">Vacinas</a>
</nav>

<main>

<button class="admin-only" onclick="mostrarForm()">‚ûï Nova vaca</button>

<form id="form" class="admin-only" style="display:none">
  <input id="nome" placeholder="Nome">
  <input id="raca" placeholder="Ra√ßa">
  <input id="touro" placeholder="Touro">
  <input id="panhou" type="date">
  <button type="button" onclick="salvar()">Salvar</button>
</form>

<table>
<thead>
<tr>
  <th onclick="ordenar('nome')">Nome</th>
  <th onclick="ordenar('raca')">Ra√ßa</th>
  <th onclick="ordenar('touro')">Touro</th>
  <th onclick="ordenar('panhou')">Panhou cria</th>
  <th onclick="ordenar('cria')">Cria em</th>
  <th class="admin-only">A√ß√µes</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</main>

<footer style="text-align:center;padding:10px">
  <span onclick="login()" style="cursor:pointer">‚öôÔ∏è</span>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let vacas = [];
let editId = null;
let asc = true;

function criaEm(data){
  const d = new Date(data);
  if (isNaN(d)) return "";
  d.setMonth(d.getMonth()+9);
  return d.toLocaleDateString("pt-BR");
}

async function carregar(){
  vacas = [];
  const snap = await getDocs(collection(db,"vacas"));
  snap.forEach(docu=>{
    const d = docu.data();
    if(!d.nome || !d.panhou_cria_em) return; // üî¥ FILTRA REGISTROS RUINS
    vacas.push({
      id: docu.id,
      nome: d.nome,
      raca: d.raca || "",
      touro: d.touro || "",
      panhou: d.panhou_cria_em,
      cria: criaEm(d.panhou_cria_em)
    });
  });
  render();
}
carregar();

function render(){
  const tb = document.getElementById("tbody");
  tb.innerHTML = "";
  vacas.forEach(v=>{
    tb.innerHTML += `
      <tr>
        <td>${v.nome}</td>
        <td>${v.raca}</td>
        <td>${v.touro}</td>
        <td>${new Date(v.panhou).toLocaleDateString("pt-BR")}</td>
        <td>${v.cria}</td>
        <td class="admin-only">
          <button onclick="editar('${v.id}')">‚úèÔ∏è</button>
          <button onclick="excluir('${v.id}')">üóëÔ∏è</button>
        </td>
      </tr>`;
  });
}

window.ordenar = campo => {
  vacas.sort((a,b)=>{
    return asc
      ? String(a[campo]).localeCompare(String(b[campo]))
      : String(b[campo]).localeCompare(String(a[campo]));
  });
  asc = !asc;
  render();
};

window.mostrarForm = ()=> document.getElementById("form").style.display="block";

window.salvar = async ()=>{
  const nomeV = nome.value;
  const racaV = raca.value;
  const touroV = touro.value;
  const panhouV = panhou.value;
  if(!nomeV || !panhouV) return alert("Nome e data obrigat√≥rios");

  if(editId){
    await updateDoc(doc(db,"vacas",editId),{
      nome:nomeV,raca:racaV,touro:touroV,panhou_cria_em:panhouV
    });
    editId=null;
  } else {
    await addDoc(collection(db,"vacas"),{
      nome:nomeV,raca:racaV,touro:touroV,panhou_cria_em:panhouV
    });
  }
  form.reset();
  form.style.display="none";
  carregar();
};

window.editar = id =>{
  const v = vacas.find(x=>x.id===id);
  nome.value=v.nome;
  raca.value=v.raca;
  touro.value=v.touro;
  panhou.value=v.panhou;
  editId=id;
  form.style.display="block";
};

window.excluir = async id =>{
  if(confirm("Excluir vaca?")){
    await deleteDoc(doc(db,"vacas",id));
    carregar();
  }
};

let admin=false;
window.login=()=>{
  if(admin) return;
  const u=prompt("Usu√°rio");
  const s=prompt("Senha");
  if(u==="Ven√≠cio" && s==="13231525"){
    admin=true;
    document.body.classList.add("admin");
    alert("ADM ativo");
  }
};
</script>

</body>
</html>
