<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Vacas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial,sans-serif;background:#fff}
header{padding:10px;text-align:center;border-bottom:1px solid #ddd}
nav{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;padding:10px;background:#7A1E2C}
nav a{color:#fff;text-decoration:none;padding:8px 12px;border-radius:6px}
nav a:hover{background:#5e1622}
main{padding:15px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;font-size:14px}
th{cursor:pointer;background:#f5f5f5}
.admin-only{display:none}
body.admin .admin-only{display:inline}
form input{padding:6px;margin:4px 0;width:100%}
form button{padding:8px;margin-top:6px}
@media(max-width:600px){
  th,td{font-size:12px}
}
</style>
</head>

<body>

<header>
  <h2>S√≠tio C√≥rrego do Pinhal</h2>
</header>

<nav>
  <a href="index.html">In√≠cio</a>
  <a href="vacas.html">Vacas</a>
  <a href="crias.html">Crias</a>
  <a href="historico.html">Hist√≥rico</a>
  <a href="bezerros.html">Bezerros</a>
  <a href="animais.html">Animais</a>
  <a href="vacinas.html">Vacinas</a>
</nav>

<main>

<button class="admin-only" onclick="mostrarForm()">‚ûï Nova Vaca</button>

<form id="formVaca" class="admin-only" style="display:none">
  <input id="nome" placeholder="Nome da vaca">
  <input id="raca" placeholder="Ra√ßa">
  <input id="touro" placeholder="Touro">
  <input id="panhou" type="date">
  <button type="button" onclick="salvar()">Salvar</button>
</form>

<table id="tabela">
<thead>
<tr>
<th onclick="ordenar(0)">Nome</th>
<th onclick="ordenar(1)">Ra√ßa</th>
<th onclick="ordenar(2)">Touro</th>
<th onclick="ordenar(3)">Panhou cria</th>
<th onclick="ordenar(4)">Cria em</th>
<th class="admin-only">A√ß√µes</th>
</tr>
</thead>
<tbody></tbody>
</table>

</main>

<footer style="text-align:center;padding:10px">
<span onclick="login()" style="cursor:pointer">‚öôÔ∏è</span>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let dados = [];
let editId = null;

function addMonths(dateStr){
  const d=new Date(dateStr);
  d.setMonth(d.getMonth()+9);
  return d.toLocaleDateString("pt-BR");
}

async function carregar(){
  const snap = await getDocs(collection(db,"vacas"));
  dados=[];
  snap.forEach(docu=>{
    const d=docu.data();
    dados.push({...d,id:docu.id,cria_em:addMonths(d.panhou_cria_em)});
  });
  render();
}
carregar();

function render(){
  const tb=document.querySelector("tbody");
  tb.innerHTML="";
  dados.forEach(d=>{
    tb.innerHTML+=`
    <tr>
      <td>${d.nome}</td>
      <td>${d.raca}</td>
      <td>${d.touro}</td>
      <td>${new Date(d.panhou_cria_em).toLocaleDateString("pt-BR")}</td>
      <td>${d.cria_em}</td>
      <td class="admin-only">
        <button onclick="editar('${d.id}')">‚úèÔ∏è</button>
        <button onclick="excluir('${d.id}')">üóëÔ∏è</button>
      </td>
    </tr>`;
  });
}

window.mostrarForm=()=>document.getElementById("formVaca").style.display="block";

window.salvar=async ()=>{
  const nome=nomeInput.value;
  const raca=racaInput.value;
  const touro=touroInput.value;
  const panhou=panhouInput.value;
  if(!nome||!panhou) return alert("Preencha nome e data");

  if(editId){
    await updateDoc(doc(db,"vacas",editId),{nome,raca,touro,panhou_cria_em:panhou});
    editId=null;
  }else{
    await addDoc(collection(db,"vacas"),{nome,raca,touro,panhou_cria_em:panhou});
  }
  formVaca.reset();
  formVaca.style.display="none";
  carregar();
};

window.editar=id=>{
  const d=dados.find(x=>x.id===id);
  nomeInput.value=d.nome;
  racaInput.value=d.raca;
  touroInput.value=d.touro;
  panhouInput.value=d.panhou_cria_em;
  editId=id;
  formVaca.style.display="block";
};

window.excluir=async id=>{
  if(confirm("Excluir vaca?")){
    await deleteDoc(doc(db,"vacas",id));
    carregar();
  }
};

let admin=false;
window.login=()=>{
  if(admin)return;
  const u=prompt("Usu√°rio");
  const s=prompt("Senha");
  if(u==="Ven√≠cio"&&s==="13231525"){
    admin=true;
    document.body.classList.add("admin");
    alert("ADM ativo");
  }
};

let asc=true;
window.ordenar=i=>{
  dados.sort((a,b)=>{
    const v1=Object.values(a)[i]||"";
    const v2=Object.values(b)[i]||"";
    return asc?String(v1).localeCompare(String(v2)):String(v2).localeCompare(String(v1));
  });
  asc=!asc;
  render();
};
</script>

</body>
</html>
