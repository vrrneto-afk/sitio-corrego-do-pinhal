<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>S√≠tio C√≥rrego do Pinhal ‚Äì Vacas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --vinho:#7A1E2C;
  --vinho-escuro:#5e1622;
  --bege:#E6C99A;
  --bege-claro:#F3E6CC;
}

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#fff;
  color:#333;
}

header{
  text-align:center;
  padding:16px;
}

header h1{
  margin:0;
  font-size:22px;
}

header small{
  display:block;
  margin-top:4px;
}

nav{
  background:var(--vinho);
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:10px;
  padding:10px;
}

nav a{
  color:#fff;
  text-decoration:none;
  font-weight:600;
}

nav a.active{
  text-decoration:underline;
}

.admin-bar{
  text-align:center;
  margin:10px 0;
}

button{
  background:var(--vinho);
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:5px;
  cursor:pointer;
}

button:hover{background:var(--vinho-escuro)}

main{
  padding:15px;
  max-width:1200px;
  margin:auto;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:14px;
}

th, td{
  border:1px solid #ccc;
  padding:6px;
  text-align:left;
}

th{
  background:#f3e6cc;
  cursor:pointer;
}

.actions button{
  margin-right:4px;
}

.admin-only{
  display:none;
}

body.admin .admin-only{
  display:inline-block;
}

form{
  margin-top:15px;
  background:#f9f9f9;
  padding:10px;
  border-radius:6px;
}

form input{
  padding:5px;
  margin:3px;
  width:100%;
}

@media (max-width:600px){
  table{font-size:13px}
}
</style>
</head>

<body>

<header>
  <h1>S√çTIO C√ìRREGO DO PINHAL</h1>
  <small>Fam√≠lia Ribeiro</small>
  <small id="dataHoje"></small>
</header>

<nav>
  <a href="index.html">In√≠cio</a>
  <a href="vacas.html" class="active">Vacas</a>
  <a href="historico.html">Hist√≥rico de Crias</a>
  <a href="bezerros.html">Bezerros(as)</a>
  <a href="vacinacao.html">Vacina√ß√£o</a>
</nav>

<div class="admin-bar">
  <span onclick="loginAdmin()" style="cursor:pointer">‚öôÔ∏è Administrador</span>
</div>

<main>
  <h2>Vacas</h2>

  <!-- FORM ADMIN -->
  <form class="admin-only" id="formVaca">
    <h3>Adicionar / Editar Vaca</h3>
    <input type="hidden" id="id">
    <input id="nome" placeholder="Nome da vaca">
    <input id="raca" placeholder="Ra√ßa">
    <input id="touro" placeholder="Touro">
    <input id="panhou" type="date">
    <button type="button" onclick="salvar()">Salvar</button>
  </form>

  <!-- TABELA -->
  <table id="tabela">
    <thead>
      <tr>
        <th onclick="ordenar('nome')">Nome</th>
        <th onclick="ordenar('raca')">Ra√ßa</th>
        <th onclick="ordenar('touro')">Touro</th>
        <th onclick="ordenar('panhou')">Panhou cria</th>
        <th onclick="ordenar('criaEm')">Cria em</th>
        <th class="admin-only">A√ß√µes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const col = collection(db,"vacas");

let dados=[];
let asc=true;

/* DATA */
document.getElementById("dataHoje").innerText =
  "Data atual: " + new Date().toLocaleDateString("pt-BR");

/* FORMATAR DATA (SEM UNDEFINED) */
function formatar(d){
  if(!d || typeof d!=="string" || !d.includes("-")) return "";
  const [a,m,di]=d.split("-");
  return `${di}/${m}/${a}`;
}

/* CALCULAR +9 MESES */
function calcularCriaEm(d){
  if(!d) return "";
  const dt=new Date(d);
  dt.setMonth(dt.getMonth()+9);
  return dt.toISOString().slice(0,10);
}

/* CARREGAR */
async function carregar(){
  dados=[];
  const snap=await getDocs(col);
  snap.forEach(docu=>{
    dados.push({id:docu.id,...docu.data()});
  });
  render();
}
carregar();

/* RENDER */
function render(){
  const tb=document.querySelector("#tabela tbody");
  tb.innerHTML="";
  dados.forEach(v=>{
    tb.innerHTML+=`
      <tr>
        <td>${v.nome||""}</td>
        <td>${v.raca||""}</td>
        <td>${v.touro||""}</td>
        <td>${formatar(v.panhou)}</td>
        <td>${formatar(v.criaEm)}</td>
        <td class="admin-only actions">
          <button onclick="editar('${v.id}')">Editar</button>
          <button onclick="excluir('${v.id}')">Excluir</button>
        </td>
      </tr>`;
  });
}

/* ORDENAR */
window.ordenar=(campo)=>{
  dados.sort((a,b)=>{
    if(a[campo]>b[campo]) return asc?1:-1;
    if(a[campo]<b[campo]) return asc?-1:1;
    return 0;
  });
  asc=!asc;
  render();
};

/* LOGIN */
window.loginAdmin=()=>{
  const u=prompt("Usu√°rio");
  const s=prompt("Senha");
  if(u==="Ven√≠cio" && s==="13231525"){
    document.body.classList.add("admin");
  }else alert("Credenciais inv√°lidas");
};

/* SALVAR */
window.salvar=async()=>{
  const id=document.getElementById("id").value;
  const panhou=document.getElementById("panhou").value;
  const obj={
    nome:nome.value.toUpperCase(),
    raca:raca.value.toUpperCase(),
    touro:touro.value.toUpperCase(),
    panhou,
    criaEm:calcularCriaEm(panhou)
  };
  if(id){
    await updateDoc(doc(db,"vacas",id),obj);
  }else{
    await addDoc(col,obj);
  }
  formVaca.reset();
  id.value="";
  carregar();
};

/* EDITAR */
window.editar=(id)=>{
  const v=dados.find(x=>x.id===id);
  id.value=v.id;
  nome.value=v.nome;
  raca.value=v.raca;
  touro.value=v.touro;
  panhou.value=v.panhou||"";
};

/* EXCLUIR */
window.excluir=async(id)=>{
  if(confirm("Excluir registro?")){
    await deleteDoc(doc(db,"vacas",id));
    carregar();
  }
};
</script>

</body>
</html>
