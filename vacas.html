<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vacas – Sítio Córrego do Pinhal</title>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#fff;color:#333}
header{text-align:center;padding:12px;border-bottom:1px solid #ddd}
nav{background:#7A1E2C;display:flex;justify-content:center;flex-wrap:wrap;gap:10px;padding:10px}
nav a{color:#fff;text-decoration:none;font-size:14px}
main{padding:15px;max-width:1200px;margin:auto}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
th{background:#f3e6cc;cursor:pointer}
.admin-only{display:none}
body.admin .admin-only{display:inline-block}
button{background:#7A1E2C;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer}
.form-box{margin-bottom:15px;border:1px solid #ccc;padding:10px;border-radius:6px}
.form-box input{margin-bottom:6px;width:100%;padding:6px}
</style>
</head>

<body>

<header>
  <h1>SÍTIO CÓRREGO DO PINHAL</h1>
  <div>Família Ribeiro</div>
  <div id="dataHoje"></div>
</header>

<nav>
  <a href="index.html">Início</a>
  <a href="vacas.html"><strong>Vacas</strong></a>
  <a href="historico.html">Histórico de Crias</a>
  <a href="bezerros.html">Bezerros(as)</a>
  <a href="vacinacao.html">Vacinação</a>
</nav>

<div style="text-align:center;margin:10px">
  <span onclick="loginAdmin()" style="cursor:pointer">⚙️ Administrador</span>
</div>

<main>

<h2>Vacas</h2>

<div class="form-box admin-only">
  <input id="nome" placeholder="Nome da vaca">
  <input id="raca" placeholder="Raça">
  <input id="touro" placeholder="Touro">
  <input type="date" id="panhou">
  <button onclick="salvar()">Salvar</button>
</div>

<table>
<thead>
<tr>
  <th onclick="ordenar(0)">Nome</th>
  <th onclick="ordenar(1)">Raça</th>
  <th onclick="ordenar(2)">Touro</th>
  <th onclick="ordenar(3)">Panhou cria</th>
  <th onclick="ordenar(4)">Cria em</th>
  <th class="admin-only">Ações</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let admin=false;
let ordemAsc=true;
let dados=[];

const colunas=["nome","raca","touro","panhou","criaEm"];

window.loginAdmin=()=>{
  const u=prompt("Usuário");
  const s=prompt("Senha");
  if(u==="Venício" && s==="13231525"){
    admin=true;
    document.body.classList.add("admin");
    carregar();
  } else alert("Credenciais inválidas");
};

function formatar(d){
  if(!d) return "";
  const [a,m,di]=d.split("-");
  return `${di}/${m}/${a}`;
}

function criaEm(p){
  const d=new Date(p);
  d.setMonth(d.getMonth()+9);
  return d.toISOString().split("T")[0];
}

window.salvar=async()=>{
  const nome=nomeEl.value;
  const raca=racaEl.value;
  const touro=touroEl.value;
  const panhou=panhouEl.value;
  if(!nome||!panhou) return alert("Preencha os campos");

  await addDoc(collection(db,"vacas"),{
    nome,raca,touro,panhou,criaEm:criaEm(panhou)
  });
  carregar();
};

async function carregar(){
  const snap=await getDocs(collection(db,"vacas"));
  dados=[];
  snap.forEach(d=>dados.push({id:d.id,...d.data()}));
  render();
}

function render(){
  lista.innerHTML="";
  dados.forEach(v=>{
    lista.innerHTML+=`
    <tr>
      <td>${v.nome}</td>
      <td>${v.raca||""}</td>
      <td>${v.touro||""}</td>
      <td>${formatar(v.panhou)}</td>
      <td>${formatar(v.criaEm)}</td>
      <td class="admin-only">
        <button onclick="excluir('${v.id}')">Excluir</button>
      </td>
    </tr>`;
  });
}

window.excluir=async(id)=>{
  if(confirm("Excluir?")){
    await deleteDoc(doc(db,"vacas",id));
    carregar();
  }
};

window.ordenar=(i)=>{
  const campo=colunas[i];
  dados.sort((a,b)=>{
    if(campo==="panhou"||campo==="criaEm"){
      return ordemAsc?new Date(a[campo])-new Date(b[campo])
                     :new Date(b[campo])-new Date(a[campo]);
    }
    return ordemAsc?String(a[campo]).localeCompare(b[campo])
                   :String(b[campo]).localeCompare(a[campo]);
  });
  ordemAsc=!ordemAsc;
  render();
};

dataHoje.innerText="Data atual: "+new Date().toLocaleDateString("pt-BR");
carregar();
</script>

</body>
</html>
