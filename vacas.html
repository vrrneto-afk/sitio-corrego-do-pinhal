<script>
function render(filtro){
  lista.innerHTML="";
  let cards=[];

  vacas.forEach(v=>{
    const ev=EVENTOS.filter(e=>e.id_animal===v.id_animal);

    const cob=ev.filter(e=>e.tipo_evento==="cobertura")
                .sort((a,b)=>new Date(b.data_evento)-new Date(a.data_evento))[0];

    const par=ev.filter(e=>e.tipo_evento==="parto")
                .sort((a,b)=>new Date(b.data_evento)-new Date(a.data_evento))[0];

    let estado="vazias",ord=0,extra="",refDate=null;

    if(cob && (!par || new Date(cob.data_evento)>new Date(par.data_evento))){
      estado="prenhas";
      const prev=addMonths(new Date(cob.data_evento),9);
      const dias=Math.max(0,Math.ceil((prev-new Date())/86400000));
      ord=1;
      refDate=prev;

      const boi=ANIMAIS.find(a=>a.id_animal===cob.id_relacionado);
      extra=`
        <span class="badge prenha">Prenha</span>
        <p>Boi: ${boi?.nome||"-"}</p>
        <p>Pegou cria: ${new Date(cob.data_evento).toLocaleDateString()}</p>
        <p>Previs√£o do parto: ${prev.toLocaleDateString()}</p>
        <p><strong>Faltam ${dias} dias</strong></p>`;
    }
    else if(par){
      estado="paridas";
      ord=2;
      refDate=new Date(par.data_evento);

      const cria=ANIMAIS.find(a=>a.id_animal===par.id_relacionado);
      extra=`
        <span class="badge parida">Parida</span>
        <p>Data do parto: ${refDate.toLocaleDateString()}</p>
        <p>Cria: ${cria?.nome||"-"}</p>`;
    }
    else{
      estado="vazias";
      ord=3;
      refDate=new Date(v.data_nascimento);
      extra=`
        <span class="badge vazia">Vazia</span>
        <p>Sem cobertura ativa</p>`;
    }

    if(filtro!=="todas" && estado!==filtro) return;

    cards.push({
      ord,
      refDate,
      html:`
      <div class="card">
        <strong>üêÑ ${v.nome}</strong>
        ${extra}
        <p>Ra√ßa: ${v.raca||"-"}</p>
        <p>Idade: ${idadeTexto(v.data_nascimento)}</p>
      </div>`
    });
  });

  cards
    .sort((a,b)=>{
      if(a.ord!==b.ord) return a.ord-b.ord;

      // Prenhas ‚Üí parto mais pr√≥ximo primeiro
      if(a.ord===1) return a.refDate-b.refDate;

      // Paridas ‚Üí parto mais recente primeiro
      if(a.ord===2) return b.refDate-a.refDate;

      // Vazias ‚Üí mais nova primeiro
      return b.refDate-a.refDate;
    })
    .forEach(c=>lista.innerHTML+=c.html);
}
</script>
