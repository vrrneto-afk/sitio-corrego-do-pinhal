<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sítio Córrego do Pinhal – Vacas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --vinho:#7A1E2C;
  --vinho-escuro:#5e1622;
  --bege:#E6C99A;
  --bege-claro:#F3E6CC;
}

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#fff;
  color:#333;
}

header{text-align:center;padding:16px}
nav{
  background:var(--vinho);
  display:flex;
  justify-content:center;
  gap:12px;
  padding:10px;
}
nav a{color:#fff;text-decoration:none;font-weight:600}
nav a.active{text-decoration:underline}

.admin-bar{text-align:center;margin:10px 0}

button{
  background:var(--vinho);
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:5px;
  cursor:pointer;
}
button:hover{background:var(--vinho-escuro)}

main{padding:15px;max-width:1200px;margin:auto}

table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
th,td{border:1px solid #ccc;padding:6px}
th{background:#f3e6cc;cursor:pointer}

.admin-only{display:none}
body.admin .admin-only{display:inline-block}

form{
  margin-top:15px;
  background:#f9f9f9;
  padding:10px;
  border-radius:6px;
}
form input{margin:4px;width:100%;padding:5px}
</style>
</head>

<body>

<header>
  <h2>SÍTIO CÓRREGO DO PINHAL</h2>
  <div>Família Ribeiro</div>
  <div id="dataHoje"></div>
</header>

<nav>
  <a href="index.html">Início</a>
  <a href="vacas.html" class="active">Vacas</a>
  <a href="historico.html">Histórico de Crias</a>
  <a href="bezerros.html">Bezerros(as)</a>
  <a href="vacinacao.html">Vacinação</a>
</nav>

<div class="admin-bar">
  <span onclick="loginAdmin()" style="cursor:pointer">⚙️ Administrador</span>
</div>

<main>
<h2>Vacas</h2>

<form class="admin-only" id="form">
  <input type="hidden" id="id">
  <input id="nome" placeholder="Nome">
  <input id="raca" placeholder="Raça">
  <input id="touro" placeholder="Touro">
  <input id="panhou" type="date">
  <button type="button" onclick="salvar()">Salvar</button>
</form>

<table>
<thead>
<tr>
  <th onclick="ordenar('nome')">Nome</th>
  <th onclick="ordenar('raca')">Raça</th>
  <th onclick="ordenar('touro')">Touro</th>
  <th onclick="ordenar('panhou')">Panhou cria</th>
  <th onclick="ordenar('criaEm')">Cria em</th>
  <th class="admin-only">Ações</th>
</tr>
</thead>
<tbody id="tb"></tbody>
</table>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "sitio-corrego-do-pinhal.firebaseapp.com",
  projectId: "sitio-corrego-do-pinhal"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const col = collection(db,"vacas");

let dados=[];
let asc=true;

document.getElementById("dataHoje").innerText =
  "Data atual: " + new Date().toLocaleDateString("pt-BR");

function fmt(d){
  if(!d) return "";
  const [a,m,di]=d.split("-");
  return `${di}/${m}/${a}`;
}

function calc(d){
  if(!d) return "";
  const x=new Date(d);
  x.setMonth(x.getMonth()+9);
  return x.toISOString().slice(0,10);
}

async function carregar(){
  dados=[];
  const snap=await getDocs(col);
  snap.forEach(d=>{
    const x=d.data();
    dados.push({
      id:d.id,
      nome:x.nome||"",
      raca:x.raca||"",
      touro:x.touro||"",
      panhou:x.panhou || x.panhou_cria || "",
      criaEm:x.criaEm || x.cria_em || ""
    });
  });
  render();
}
carregar();

function render(){
  tb.innerHTML="";
  dados.forEach(v=>{
    tb.innerHTML+=`
    <tr>
      <td>${v.nome}</td>
      <td>${v.raca}</td>
      <td>${v.touro}</td>
      <td>${fmt(v.panhou)}</td>
      <td>${fmt(v.criaEm)}</td>
      <td class="admin-only">
        <button onclick="editar('${v.id}')">Editar</button>
        <button onclick="excluir('${v.id}')">Excluir</button>
      </td>
    </tr>`;
  });
}

window.ordenar=(c)=>{
  dados.sort((a,b)=>a[c]>b[c]? (asc?1:-1):(asc?-1:1));
  asc=!asc;
  render();
};

window.loginAdmin=()=>{
  const u=prompt("Usuário");
  const s=prompt("Senha");
  if(u==="Venício" && s==="13231525"){
    document.body.classList.add("admin");
  }else alert("Inválido");
};

window.salvar=async()=>{
  const d=panhou.value;
  const obj={
    nome:nome.value.toUpperCase(),
    raca:raca.value.toUpperCase(),
    touro:touro.value.toUpperCase(),
    panhou:d,
    criaEm:calc(d)
  };
  if(id.value){
    await updateDoc(doc(db,"vacas",id.value),obj);
  }else{
    await addDoc(col,obj);
  }
  form.reset();
  id.value="";
  carregar();
};

window.editar=(i)=>{
  const v=dados.find(x=>x.id===i);
  id.value=v.id;
  nome.value=v.nome;
  raca.value=v.raca;
  touro.value=v.touro;
  panhou.value=v.panhou;
};

window.excluir=async(i)=>{
  if(confirm("Excluir?")){
    await deleteDoc(doc(db,"vacas",i));
    carregar();
  }
};
</script>

</body>
</html>
