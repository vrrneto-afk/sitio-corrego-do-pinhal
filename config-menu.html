<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configura√ß√£o ‚Äì Menu</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="menu-adm.css">
<link rel="stylesheet" href="config.css">
</head>

<body style="display:none">

<div id="app" class="hidden">

<header>‚öôÔ∏è Configura√ß√µes</header>
<div id="menu-adm"></div>

<div class="container">

<h2>Configura√ß√£o ‚Äì Menu</h2>

<div class="cards-grid" id="lista-menu"></div>

<div id="editor" class="hidden">
<fieldset>

<label>ID (fixo)</label>
<input type="text" id="menu_id" disabled>

<label>T√≠tulo</label>
<input type="text" id="menu_titulo">

<label>√çcone</label>
<input type="text" id="menu_icone">

<label>Ordem</label>
<input type="number" id="menu_ordem">

<label>
  <input type="checkbox" id="menu_ativo"> Item ativo
</label>

</fieldset>

<button class="salvar" onclick="salvarItem()">üíæ Salvar</button>
<button class="voltar" onclick="cancelarEdicao()">‚ùå Cancelar</button>
</div>

<button class="voltar" onclick="location.href='config.html'">
‚¨Ö Voltar para Configura√ß√µes
</button>

</div>
</div>

<script>
fetch("menu-adm.html")
.then(r=>r.text())
.then(html=>{
  document.getElementById("menu-adm").innerHTML = html;
});

firebase.initializeApp({
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
});

const db = firebase.firestore();

let itens = [];
let editando = null;

document.body.style.display="block";
document.getElementById("app").classList.remove("hidden");
carregar();

async function carregar(){
  const snap = await db.collection("config").doc("menu").get();
  if(!snap.exists) return;
  itens = snap.data().items || [];
  renderizar();
}

function renderizar(){
  const area = document.getElementById("lista-menu");
  area.innerHTML = "";

  itens.forEach((m,i)=>{
    const b = document.createElement("button");
    b.className="config-card";
    b.onclick=()=>editar(i);
    if(m.ativo===false) b.style.opacity="0.5";
    b.innerHTML = `<strong>${m.icone} ${m.titulo}</strong><span>ID: ${m.id} ‚Ä¢ Ordem: ${m.ordem}</span>`;
    area.appendChild(b);
  });
}

function editar(i){
  editando = i;
  const m = itens[i];
  menu_id.value = m.id;
  menu_titulo.value = m.titulo;
  menu_icone.value = m.icone;
  menu_ordem.value = m.ordem;
  menu_ativo.checked = m.ativo !== false;
  editor.classList.remove("hidden");
}

async function salvarItem(){
  const m = itens[editando];
  m.titulo = menu_titulo.value.trim();
  m.icone = menu_icone.value.trim();
  m.ordem = Number(menu_ordem.value);
  m.ativo = menu_ativo.checked;
  await db.collection("config").doc("menu").update({items:itens});
  cancelarEdicao();
  renderizar();
}

function cancelarEdicao(){
  editor.classList.add("hidden");
  editando = null;
}
</script>

<script src="auth-guard.js"></script>
<script src="auth-adm.js"></script>

</body>
</html>
