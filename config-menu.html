<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configura√ß√£o ‚Äì Menu</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="menu-adm.css">
<link rel="stylesheet" href="config.css">

<style>
.check-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:12px;
  font-weight:600;
}
.check-row input{margin:0;}
</style>
</head>

<body style="display:none">

<div id="app" class="hidden">

<header>‚öôÔ∏è Configura√ß√µes</header>
<div id="menu-adm"></div>

<div class="container">

<h2>Configura√ß√£o ‚Äì Menu</h2>

<div class="cards-grid" id="lista-menu"></div>

<div id="editor" class="hidden">
<fieldset>

<label>ID do menu (fixo)</label>
<input type="text" id="menu_id" disabled>

<label>T√≠tulo exibido</label>
<input type="text" id="menu_titulo">

<label>√çcone (emoji)</label>
<input type="text" id="menu_icone" placeholder="Ex: üè† üêÑ üìä">

<label>Ordem</label>
<input type="number" id="menu_ordem" min="1">

<div class="check-row">
  <input type="checkbox" id="menu_ativo" checked>
  <label for="menu_ativo">Item ativo</label>
</div>

</fieldset>

<button class="salvar" onclick="salvarItem()">üíæ Salvar</button>
<button class="voltar" onclick="cancelarEdicao()">‚ùå Cancelar</button>
</div>

<button class="voltar" onclick="location.href='config.html'">
‚¨Ö Voltar para Configura√ß√µes
</button>

</div>
</div>

<script>
/* MENU ADM */
fetch("menu-adm.html")
.then(r=>r.text())
.then(html=>{
  document.getElementById("menu-adm").innerHTML = html;
});

/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyCW-CuFDrOLO-dteckl_GrPTocmyS-IrzY",
  authDomain:"sitio-corrego-do-pinhal.firebaseapp.com",
  projectId:"sitio-corrego-do-pinhal"
});

const auth = firebase.auth();
const db   = firebase.firestore();

let itens = [];
let indiceEditando = null;

/* AUTH ‚Äî IGUAL AO ESP√âCIES */
auth.onAuthStateChanged(user=>{
  if(user){
    document.body.style.display="block";
    document.getElementById("app").classList.remove("hidden");
    carregar();
  }
});

/* LOAD */
async function carregar(){
  const snap = await db.collection("config").doc("menu").get();
  if(!snap.exists) return;

  itens = snap.data().items || [];
  renderizarCards();
}

/* RENDER */
function renderizarCards(){
  const area = document.getElementById("lista-menu");
  area.innerHTML = "";

  itens.forEach((m,i)=>{
    const btn = document.createElement("button");
    btn.className="config-card";
    btn.onclick=()=>editarItem(i);

    if(m.ativo === false) btn.style.opacity = "0.5";

    btn.innerHTML = `
      <strong>${m.icone || "üìÅ"} ${m.titulo}${m.ativo===false?" (Inativo)":""}</strong>
      <span>ID: ${m.id} ‚Ä¢ Ordem: ${m.ordem}</span>
    `;
    area.appendChild(btn);
  });
}

/* EDITAR */
function editarItem(i){
  indiceEditando = i;
  const m = itens[i];

  menu_id.value     = m.id || "";
  menu_titulo.value = m.titulo || "";
  menu_icone.value  = m.icone || "";
  menu_ordem.value  = m.ordem || 0;
  menu_ativo.checked = m.ativo !== false;

  editor.classList.remove("hidden");
}

/* SALVAR */
async function salvarItem(){
  if(indiceEditando === null) return;

  const m = itens[indiceEditando];

  m.titulo = menu_titulo.value.trim();
  m.icone  = menu_icone.value.trim();
  m.ordem  = Number(menu_ordem.value);
  m.ativo  = menu_ativo.checked;

  if(!m.titulo){
    alert("Informe o t√≠tulo.");
    return;
  }

  await db.collection("config").doc("menu").update({ items: itens });

  cancelarEdicao();
  renderizarCards();
}

/* CANCELAR */
function cancelarEdicao(){
  editor.classList.add("hidden");
  indiceEditando = null;
}
</script>

<script src="auth-adm.js"></script>
</body>
</html>
